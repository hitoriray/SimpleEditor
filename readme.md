## 简单行编辑器

### 一、要解决的问题

文本编辑程序是利用计算机进行文字加工的基本软件工具，实现对文本文件的插入、删除等修改操作。限制这些操作以行为单位进行的编辑程序称为行编辑程序。被编辑的文本文件可能很大，全部读入编辑程序的数据空间（内存）的做>法既不经济，也不总能实现。一种解决方法是逐段地编辑。任何时刻只把待编辑文件的一段放在内存，称为活区。试按照这种方法实现一个简单的行编辑程序。设文件每行不超过320个字符，很少超过80字符。

****

### 二、算法基本思想描述

- 字符串匹配算法：BF、KMP、Tire以及AC自动机
    - BF算法：暴力枚举母串起点和模式串的每一个字符，进行逐个匹配。时间复杂度：$O(NM)$
    - KMP算法：该算法的核心是利用匹配失败后的信息，尽量减少模式串与主串的匹配次数以达到快速匹配的目的。具体实现就是通过一个next[]函数实现，函数本身包含了模式串的局部匹配信息。时间复杂度：$O(N+M)$
    - Trie算法：Trie树(字典树)是一个可以**高效地存储和查找**字符串集合的一种多叉树的数据结构。每个节点都拥有若干个字符指针，若在插入或检索字符串时扫描到一个字符c，就沿着当前节点的c字符指针，走向该指针指向的节点>。时间复杂度：$O(M)$，空间复杂度：$O(NM)$。（其中N为节点个数，M为字符集大小）

****

### 三、设计

#### 1. 功能描述
程序开始运行时需要键入输入和输出文件。其中输入文件可以为空，表示不从外部文件读取文本。之后会在屏幕上显示当前活区所展示的文本内容（最多100行），第一次使用该编辑器的用户可以键入`help`获取帮助菜单。

##### help menu
- 行插入。格式：i<行号><回车><文本><回车>   将<文本>插入活区中第<行号>行之后。
    > Insert Line: Format - i<line_number><Enter><text><Enter>. Inserts <text> after line <line_number> in the active area.
- 行删除。格式：d<行号1>[ <行号2>]<回车>    删除活区中第<行号1>行（到第<行号2>行）。
    > Delete Line: Format - d<line_number1>[ <line_number2>]<Enter>. Deletes line <line_number1> (to line <line_number2>) in the active area.
- 活区切换。格式：n<回车>   将活区写入输出文件，并从输入文件中读入下一段，作为新的活区。
    > Switch Active Area: Format - n<Enter>
- 活区显示。格式：p<回车>   逐页地（每页20行）显示活区内容。
    > Display Active Area: Format - p<Enter>
- 串替换。格式：S<行号>@<串1>@<串2><回车>   将第<行号>行中的<串1>替换成<串2>。
    > Replace String: Format - S<line_number>@<string1>@<string2><Enter>. Replaces <string1> with <string2> in line <line_number> of the active area.
- 串匹配。格式：m <串><回车>   匹配活区内所有<串>，并打印匹配成功的位置。
    > Match String: Format - m<string><Enter>. Matches all occurrences of <string> in the active area.
- 读取外部文件。格式：r <文件名><回车>    若当前非活区为空，则可以从外部文件中读入新文本作为待操作内容。
    > Read From File: Format - r <file_name><enter>.
- 写入外部文件。格式：w <文件名>[ <行号1>[ <行号2>]]    将活区中（第<行号1>行（到第<行号2>行））的内容写入外部文件中。
    > Write To File: Format - w <file_name>[ <line_number1>[ <line_number2>]]<enter>.
- 退出编辑器。格式：exit<回车> 
    > Exit: Format - exit

****

#### 2. 活区的表示

- `活区`指的是用户当前可修改的文本区，活区最多可以存$100$行文本，每行文本的最大长度为$320$个字符。用户可以从**输入文件**中读取文本到活区中，若输入文件文本内容多于$80$行，则只读取前$80$行文本，留下$20$行给用户操作的空间，而输入文件中的其余文本会暂时存入`非活区`中。
- 用户可对文本进行自定义修改，修改结束后按下`n`写到**输出文件**中。此时若`非活区`中还存有文本，则将非活区中的文本继续按照上述方式继续读入活区中。
- 考虑到文本文件行长通常为正态分布，且峰值在$60 \sim 70$之间，用$320×100$大小的字符数组实现存储将造成大量浪费。因此本编辑器采用以标准行块为单位为各行分配存储，每个标准行块含$80$个字符，并且用动态链表将每一个行块连接起来，从而不会导致内存的浪费。

****

#### 3. 活区中每一行的表示

- 每一行采用行块链表存储，每一块最多存储$80$个字符，若超出限制，则新增一个行块，并且将其于前面的行块连接起来，构成动态链表的形式。如下图所示：



****

#### 4. 字符串匹配算法的设计

用户可以选择采用哪种匹配算法对字符串进行匹配，目前仅提供3种算法：KMP、Trie、BF。默认采用KMP算法进行字符串匹配。
- KMP算法
    该算法的核心为next数组，next数组的含义：next[i]表示以i为结尾的后缀最多有多少个字符与前缀相等。在匹配过程中，若未匹配成功，则跳到next所指向的地方继续匹配，而不是每次都跳到起点重新匹配。更详细的算法思路可以参考我之前写过的一篇博客：https://blog.csdn.net/m0_75186429/article/details/134505128?spm=1001.2014.3001.5501

- BF算法
  即$BF(Brute Force)$算法。顾名思义，是一种最朴素也是最易理解的字符串匹配算法。在匹配过程中，若未匹配成功，则直接跳到起点进行下一次匹配，时间复杂度较高，效率不如KMP算法。
- Trie树
  又称字典树或前缀树，是一种用于实现字符串快速检索的多叉树结构。匹配效率和KMP算法不相上下。

****
